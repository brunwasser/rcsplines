<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Steven M. Brunwasser, Ph.D." />

<meta name="date" content="2022-11-19" />

<title>Using Restricted Cubic Splines in Structural Equation Models</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Applications of Restricted Cubic Splines in SEM</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="about.html">Purpose</a>
</li>
<li>
  <a href="index.html">Demonstrations</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Using Restricted Cubic Splines in
Structural Equation Models</h1>
<h4 class="author">Steven M. Brunwasser, Ph.D.</h4>
<h4 class="date">2022-11-19</h4>

</div>


<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warning =</span> F,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> F </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                      )</span></code></pre></div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The purpose of this page is to demonstrate how restricted cubic
splines (RCSs) to model nonlinear effects of predictors and nonlinear
growth trajectories within a structural equation models (SEMs). First, I
will show how to implement RCSs in ordinary least squares (OLS) and
generalized least square (GLS) models. Then I will show how to implement
RCSs in the context of SEMs.</p>
<p>** This is a work-in-progress. Please let me know if you spot any
errors or have suggestions.**</p>
</div>
<div id="workspace-prep" class="section level2">
<h2>Workspace Prep</h2>
<p>Load require package. You may have to install these packages if you
have never installed them before using the
<strong>install.packages()</strong> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( data.table )</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( ggplot2 )</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( mgcv )</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( rms )</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( Hmisc )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( lavaan )</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( ERP )</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( MASS )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( nlme )</span></code></pre></div>
</div>
<div id="demonstration-in-ols-regression" class="section level2">
<h2>Demonstration in OLS regression</h2>
<p>Prior to demonstrating the use of restricted cubic splines (RCSs) in
structural equation models (SEM), we will use RCSs to model a nonlinear
association in an ordinary least squares (OLS) model using the <a
href="https://CRAN.R-project.org/package=rms">rms</a> package. There are
several helpful overviews for this package, including <a
href="https://www.nicholas-ollberding.com/post/an-introduction-to-the-harrell-verse-predictive-modeling-using-the-hmisc-and-rms-packages/">this
one</a> and <a
href="https://www.r-bloggers.com/2016/07/introduction-to-the-rms-package/">this
one</a>.</p>
<p>First, let’s simulate data with a nonlinear association that does not
follow a simple polynomial function. Goldfield and Wujciak-Jens provide
<a
href="https://www.rdatagen.net/post/2022-08-09-simulating-data-from-a-non-linear-function-by-specifying-some-points-on-the-curve/">helpful
code</a> to accomplish this. Please see their code and explanations for
a detailed explanation of this approach.</p>
<p>As seen in the figure below, we simulated a response variable (<span
class="math inline">\(y\)</span>) whose values twice rise and fall
rapidly as values of the predictor variable (<span
class="math inline">\(x\)</span>) increase. The predictor and response
variables are housed in the dataframe <em>mdata</em>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">40</span>, <span class="dv">25</span>, <span class="dv">22</span>, <span class="dv">35</span>, <span class="dv">24</span>, <span class="dv">15</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">copy</span>(dd)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>dc[, xend <span class="sc">:</span><span class="er">=</span> (<span class="fu">shift</span>(x, <span class="at">type =</span> <span class="st">&quot;lead&quot;</span>))]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>dc[, yend <span class="sc">:</span><span class="er">=</span> (<span class="fu">shift</span>(y, <span class="at">type =</span> <span class="st">&quot;lead&quot;</span>))]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> dc[ <span class="sc">-</span>.N]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>dc[, id <span class="sc">:</span><span class="er">=</span> .I]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>interp_line <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, xend, yend) {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  slope <span class="ot">&lt;-</span> (yend <span class="sc">-</span> y)<span class="sc">/</span>(xend <span class="sc">-</span> x)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> y <span class="sc">-</span> slope<span class="sc">*</span>x</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  newx <span class="ot">&lt;-</span> <span class="fu">seq</span>(x, xend, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  newy <span class="ot">&lt;-</span> newx<span class="sc">*</span>slope <span class="sc">+</span> b</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">x =</span> newx, <span class="at">y =</span> newy)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> dc[, <span class="fu">interp_line</span>(x, y, xend, yend), keyby <span class="ot">=</span> id]</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>dx</span></code></pre></div>
<pre><code>##      id        x        y
##   1:  1 20.00000 15.00000
##   2:  1 20.10101 15.25253
##   3:  1 20.20202 15.50505
##   4:  1 20.30303 15.75758
##   5:  1 20.40404 16.01010
##  ---                     
## 596:  6 79.59596 15.36364
## 597:  6 79.69697 15.27273
## 598:  6 79.79798 15.18182
## 599:  6 79.89899 15.09091
## 600:  6 80.00000 15.00000</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>gam.fit <span class="ot">&lt;-</span> <span class="fu">gam</span>(y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">k =</span> <span class="dv">7</span>), <span class="at">data =</span> dx)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>dx[, ypred <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(gam.fit)]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">10000</span>, <span class="dv">20</span>, <span class="dv">85</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>mdata<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(gam.fit, <span class="at">newdata =</span> mdata) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mdata),<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mdata, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>)  <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">20</span>, <span class="dv">80</span>, <span class="dv">5</span> ) )</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We start by storing key features of our data frame using the
<strong>datadist()</strong> function in the <em>rms</em> package. This
will make data summaries, predictions, and plotting more efficient. We
then use the <strong>ols()</strong> function to run a regression model
(stored in an object called <em>ols.rcs5</em>) in which the effect of
<span class="math inline">\(x\)</span> on <span
class="math inline">\(y\)</span> is modeled with a 6-knot RCS. RCSs
require <span class="math inline">\(df=k-1\)</span>, where <span
class="math inline">\(k\)</span> is the number of knots. Therefore, the
effect of <span class="math inline">\(x\)</span> will require (<span
class="math inline">\(df=5\)</span>). Note, that the model code looks
like a standard R regression model (y ~ x) except that the function
<strong>rcs()</strong> is called for the <span
class="math inline">\(x\)</span> variable, telling the regression model
to estimate a restricted cubic spline with 6 knots. We did not specify
where to place the knots, so <em>rms</em> will use the default position
values with the outer knots placed at the 0.10 and 0.90 quantiles and
inner knots at equally spaced intervals in between.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>( mdata )</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>( <span class="at">datadist =</span> <span class="st">&#39;dd&#39;</span> ) </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ols.rcs5 <span class="ot">&lt;-</span> <span class="fu">ols</span>( y <span class="sc">~</span> <span class="fu">rcs</span>( x, <span class="dv">6</span> ), <span class="at">data =</span> mdata )</span></code></pre></div>
<p>The <strong>print()</strong> function shows indices of model fit
(e.g., <span class="math inline">\(R^2\)</span>), the model likelihood
ratio test, and the <span class="math inline">\(k-1\)</span> effects of
<span class="math inline">\(x\)</span>, representing the model-implied
rate of change in <span class="math inline">\(y\)</span> for the
different segments of <span class="math inline">\(x\)</span> defined by
the spline knots. We can see that the effects of <span
class="math inline">\(x\)</span> is easily different than 0 with
alternating signs, capturing the rapid rises and descents of <span
class="math inline">\(y\)</span> over the range of <span
class="math inline">\(x\)</span> values.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>( ols.rcs5 )</span></code></pre></div>
<pre><code>## Linear Regression Model
##  
##  ols(formula = y ~ rcs(x, 6), data = mdata)
##  
##                    Model Likelihood    Discrimination    
##                          Ratio Test           Indexes    
##  Obs   10000    LR chi2    21723.01    R2       0.886    
##  sigma2.3470    d.f.              5    R2 adj   0.886    
##  d.f.   9994    Pr(&gt; chi2)   0.0000    g        7.489    
##  
##  Residuals
##  
##       Min       1Q   Median       3Q      Max 
##  -8.40068 -1.58746  0.01796  1.60307 10.24834 
##  
##  
##            Coef     S.E.   t       Pr(&gt;|t|)
##  Intercept -16.0106 0.3258  -49.14 &lt;0.0001 
##  x           1.7298 0.0118  146.56 &lt;0.0001 
##  x&#39;        -19.3577 0.1079 -179.47 &lt;0.0001 
##  x&#39;&#39;        63.8037 0.3429  186.10 &lt;0.0001 
##  x&#39;&#39;&#39;      -89.2816 0.4995 -178.74 &lt;0.0001 
##  x&#39;&#39;&#39;&#39;      67.1363 0.5032  133.43 &lt;0.0001 
## </code></pre>
<p>We typically would like a statistical test for the overall effect of
<span class="math inline">\(x\)</span> with <span
class="math inline">\(df=5\)</span> in this case. The
<strong>anova.rms()</strong> function provides an overall <span
class="math inline">\(F\)</span> test and a test of whether there is
evidence of nonlinearity in the effect of <span
class="math inline">\(x\)</span> on <span
class="math inline">\(y\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>( ols.rcs5 )</span></code></pre></div>
<pre><code>##                 Analysis of Variance          Response: y 
## 
##  Factor     d.f. Partial SS MS          F        P     
##  x             5 428209.95  85641.99026 15547.58 &lt;.0001
##   Nonlinear    4 310437.00  77609.25011 14089.31 &lt;.0001
##  REGRESSION    5 428209.95  85641.99026 15547.58 &lt;.0001
##  ERROR      9994  55050.75      5.50838</code></pre>
<p>Interpreting the 5 RCS coefficient for the effect of <span
class="math inline">\(x\)</span> on <span
class="math inline">\(y\)</span> is not straightforward. The best way to
interpret the effect is visually. The <strong>Predict()</strong>
function makes it simple to obtain model-predicted values of <span
class="math inline">\(y\)</span> against levels of <span
class="math inline">\(x\)</span>. We can plot these predictions easily
using <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="fu">Predict</span>( ols.rcs5, x ) )</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>A commonly used alternative to RCSs for modeling nonlinear effects of
continuous predictors are polynomial regressions, where we include
values of <span class="math inline">\(x\)</span> raised to higher powers
(e.g., <span class="math inline">\(x^2\)</span> for a quadratic effect).
Let’s run a competing polynomial regression model that invests the same
number of <span class="math inline">\(df\)</span> as the RCS model we
ran previously. We can use the <strong>pol()</strong> function to run a
quintic polynomial regression with <span
class="math inline">\(df=5\)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ols.pol5 <span class="ot">&lt;-</span> <span class="fu">ols</span>( y <span class="sc">~</span> <span class="fu">pol</span>( x, <span class="dv">5</span> ), <span class="at">data =</span> mdata )</span></code></pre></div>
<p>Now we can compare indices of model fit across the RCS and polynomial
models. We can see that the <span class="math inline">\(R^2\)</span>
value is slightly larger in the RCS model compared to the quintic
polynomial (0.89 vs. 0.84), though both do quite well in fitting the
data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ols.model <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;6-Knot RCS&#39;</span>,<span class="st">&#39;Quintic Polynomial&#39;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ols.r2 <span class="ot">&lt;-</span> <span class="fu">c</span>( ols.rcs5<span class="sc">$</span>stats[<span class="dv">4</span>], ols.pol5<span class="sc">$</span>stats[<span class="dv">4</span>] )</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ols.fit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">rbind</span>( ols.model, ols.r2 )  )</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>ols.fit</span></code></pre></div>
<pre><code>##                          R2               R2.1
## ols.model        6-Knot RCS Quintic Polynomial
## ols.r2    0.886084775638528  0.839633407999546</code></pre>
<p>We can better see how well the RCS and quintic polynomial models do
in capturing the data by plotting the model predictions against the
observed data. In the plot below, the vertical dashed lines show where
the 5 RCS knots are located. Both do a good job fitting the data, but
the RCS model better captures the drop and rise in <span
class="math inline">\(y\)</span> than the polynomial model. Also, the
polynomial model prediction line curves up after the final knot on the
far right end of the <span class="math inline">\(x\)</span>
distribution, whereas the RCS model constrains the line to be linear
(straight) in the extremes of the distribution, beyond the first and
last knots.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ols.rcs5.pred <span class="ot">&lt;-</span> <span class="fu">Predict</span>( ols.rcs5, x ) </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ols.pol5.pred <span class="ot">&lt;-</span> <span class="fu">Predict</span>( ols.pol5, x ) </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>ols5.pred <span class="ot">&lt;-</span> <span class="fu">rbind</span>( ols.rcs5.pred, ols.pol5.pred )</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ols5.pred<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">rep</span>( <span class="fu">c</span>( <span class="st">&#39;6-Knot RC Spline&#39;</span>,<span class="st">&#39;Quintic Polynomial&#39;</span> ), <span class="at">each =</span> <span class="dv">200</span> )</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>cbbPalette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#E69F00&quot;</span>,<span class="st">&quot;#0072B2&quot;</span> , <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>ols.pred5.plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>mdata, <span class="fu">aes</span>( <span class="at">x=</span>x, <span class="at">y=</span>y ), <span class="at">color =</span> <span class="st">&#39;darkgray&#39;</span>, <span class="at">shape =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">data=</span>ols5.pred, <span class="fu">aes</span>( <span class="at">x=</span>x, <span class="at">y=</span>yhat, <span class="at">group =</span> model, <span class="at">colour=</span>model, <span class="at">linetype =</span> model ), <span class="at">size =</span> <span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>( <span class="at">values=</span>cbbPalette ) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>( <span class="at">xintercept =</span> <span class="fu">rcspline.eval</span>( mdata<span class="sc">$</span>x, <span class="at">nk =</span> <span class="dv">6</span>, <span class="at">knots.only =</span> T ), <span class="at">linetype =</span> <span class="dv">3</span> ) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">rcspline.eval</span>( mdata<span class="sc">$</span>x, <span class="at">nk =</span> <span class="dv">6</span>, <span class="at">knots.only =</span> T ),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;23.15</span><span class="sc">\n</span><span class="st">Knot 1&#39;</span>,<span class="st">&#39;35.06</span><span class="sc">\n</span><span class="st">Knot 2&#39;</span>,<span class="st">&#39;46.74</span><span class="sc">\n</span><span class="st">Knot 3&#39;</span>,<span class="st">&#39;58.04</span><span class="sc">\n</span><span class="st">Knot4&#39;</span>,<span class="st">&#39;69.63</span><span class="sc">\n</span><span class="st">Knot5&#39;</span>,<span class="st">&#39;81.61</span><span class="sc">\n</span><span class="st">Knot 6&#39;</span>)) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">colour=</span><span class="st">&#39;Model Type&#39;</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype =</span><span class="st">&#39;Model Type&#39;</span>) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">axis.text.x =</span>  <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.title =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.text =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">12</span> ),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.title =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>),</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span> )</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>ols.pred5.plot</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="672" />
<br></p>
</div>
<div id="gls-model-with-erp-data" class="section level2">
<h2>GLS Model with ERP Data</h2>
<p>In this section, we’ll use data from the <a
href="https://cran.r-project.org/web/packages/ERP/vignettes/ERP.html">ERP
package</a> to model event-related potential (ERP) trajectories. I use
these data because ERP amplitudes follow complex nonlinear trajectories.
The impulsivity data from the ERP package is in the wide format with
repeated measures of amplitude stored in multiple columns. Below, we
reshape the data so that it is in the long format.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(impulsivity)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>impulsivity1 <span class="ot">&lt;-</span> <span class="fu">subset</span>( impulsivity, <span class="sc">!</span><span class="fu">duplicated</span>( impulsivity<span class="sc">$</span>Subject ) )</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">reshape</span>( impulsivity1,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">direction =</span> <span class="st">&#39;long&#39;</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">timevar =</span> <span class="st">&#39;time&#39;</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">varying =</span> <span class="fu">list</span>( <span class="at">out =</span> <span class="fu">colnames</span>( impulsivity )[<span class="dv">5</span><span class="sc">:</span><span class="dv">505</span>] ),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">idvar =</span> <span class="st">&#39;Subject&#39;</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">times =</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">2</span> )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<p>Now that the data is in the appropriate format, we can model
longitudinal trajectories using RCSs. As these are repeated measures
data, we’ll use GLS models with a first-order autoregressive error
structure (AR1) to capture non-independence in the errors over time. As
we don’t know how many knots are needed for the RCSs to obtain a
reasonable fir, below I fit GLS models modeling the effect of time with
8-, 7-, and 6-knot RCSs. We can compare the Akaike Information Criterion
for each of these models to aid in model selection <a
href="https://www.amazon.com/Regression-Modeling-Strategies-Applications-Statistics/dp/3319194240">(Harrell
2015)</a>. The model with the smallest AIC value will be considered the
one that best captures the effect of x on y without overfitting. The
7-knot RCS model (<span class="math inline">\(df=6\)</span> invested in
the time effect) is best according to the AIC.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ddimp <span class="ot">&lt;-</span> <span class="fu">datadist</span>( imp )</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>( <span class="at">datadist =</span> ddimp )</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># imp.rcs7 &lt;- Gls( T_0 ~ rcs( time, 8 ),</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                  correlation = corAR1( form = ~time | Subject  ),</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                  data = imp,</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                  x = T ) </span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># save( imp.rcs7, file=&#39;imp.rcs7.RData&#39; )</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>( <span class="st">&#39;imp.rcs7.RData&#39;</span> )</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># imp.rcs6 &lt;- Gls( T_0 ~ rcs( time, 7 ),</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                  correlation = corAR1( form = ~time | Subject  ),</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                  data = imp,</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                  x = T )</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># save( imp.rcs6, file=&#39;imp.rcs6.RData&#39; )</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>( <span class="st">&#39;imp.rcs6.RData&#39;</span> )</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># imp.rcs5 &lt;- Gls( T_0 ~ rcs( time, 6 ),</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                 correlation = corAR1( form = ~time | Subject  ),</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                  data = imp,</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                  x = T )</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># save( imp.rcs5, file=&#39;imp.rcs5.RData&#39; )</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>( <span class="st">&#39;imp.rcs5.RData&#39;</span> )</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>imp.rcs7.aic <span class="ot">&lt;-</span> <span class="fu">AIC</span>( imp.rcs7 )</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>imp.rcs6.aic <span class="ot">&lt;-</span> <span class="fu">AIC</span>( imp.rcs6 )</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>imp.rcs5.aic <span class="ot">&lt;-</span> <span class="fu">AIC</span>( imp.rcs5 )</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( <span class="at">AIC =</span> <span class="fu">c</span>(imp.rcs7.aic, imp.rcs6.aic, imp.rcs5.aic ),</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">DF =</span> <span class="fu">c</span>( <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span> ) )</span></code></pre></div>
<pre><code>##        AIC DF
## 1 64298.24  7
## 2 64146.42  6
## 3 64810.86  5</code></pre>
<p>Evaluate the 6-knot RCS model. The time effects are all non-zero and
the coefficients change sign indicating change in direction of the
regression slope.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>( imp.rcs6 )</span></code></pre></div>
<pre><code>## Generalized Least Squares Fit by REML
##  
##  Gls(model = T_0 ~ rcs(time, 7), data = imp, correlation = corAR1(form = ~time | 
##      Subject), x = T)
##  
##                                                      
##    Obs12024    Log-restricted-likelihood-32064.21    
##  Clusters24                        Model d.f.   6    
##     g 3.455                        sigma   3.4750    
##                                    d.f.     12017    
##  
##            Coef    S.E.   t      Pr(&gt;|t|)
##  Intercept  0.3276 0.1491   2.20 0.0281  
##  time      -0.0273 0.0015 -18.45 &lt;0.0001 
##  time&#39;      0.8024 0.0189  42.50 &lt;0.0001 
##  time&#39;&#39;    -2.6273 0.0569 -46.15 &lt;0.0001 
##  time&#39;&#39;&#39;    3.2949 0.0787  41.85 &lt;0.0001 
##  time&#39;&#39;&#39;&#39;  -2.0047 0.0824 -24.33 &lt;0.0001 
##  time&#39;&#39;&#39;&#39;&#39;  0.6655 0.0787   8.45 &lt;0.0001 
##  
##  Correlation Structure: ARMA(1,0)
##   Formula: ~time | Subject 
##   Parameter estimate(s):
##  Phi1 
##     0 
## </code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>( imp.rcs6 )</span></code></pre></div>
<pre><code>##                 Wald Statistics          Response: T_0 
## 
##  Factor     Chi-Square d.f. P     
##  time       9533.83    6    &lt;.0001
##   Nonlinear 8999.03    5    &lt;.0001
##  TOTAL      9533.83    6    &lt;.0001</code></pre>
<p>Below I fit a sextic polynomial model for comparison.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imp.pol6 &lt;- Gls( T_0 ~ pol( time, 6 ),</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                  correlation = corAR1( form = ~time | Subject  ),</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                  data = imp,</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                  x = T )</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#save( imp.pol6, file=&#39;imp.pol6.RData&#39; )</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>( <span class="st">&#39;imp.pol6.RData&#39;</span> )</span></code></pre></div>
<p>Plotting the predicted values from the 6-knot RCS model and the
sextic polynomial function. Again, the 7-knot RCS model is better able
to capture the initial decline and then rapid rise in amplitude between
the 1st and 3rd knots than the polynomial function with the same number
of degrees of freedom invested in the time effect.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>imp.rcs6.pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">Predict</span>( imp.rcs6, time ) )</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>imp.rcs6.pred<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">&#39;7-Knot RC Spline&#39;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>imp.pol6.pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">Predict</span>( imp.pol6, time ) )</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>imp.pol6.pred<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">&#39;Sextic Polynomial&#39;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>imp6.pred <span class="ot">&lt;-</span> <span class="fu">rbind</span>( imp.rcs6.pred, imp.pol6.pred )</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>imp6.pred<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">factor</span>( imp6.pred<span class="sc">$</span>model )</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>impplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">data=</span>imp, <span class="fu">aes</span>( <span class="at">x=</span>time, <span class="at">y=</span>T_0, <span class="at">group =</span> Subject  ), <span class="at">colour=</span><span class="st">&#39;darkgray&#39;</span> ) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">data=</span>imp6.pred, <span class="fu">aes</span>( time, yhat, <span class="at">group =</span> model, <span class="at">colour =</span> model, <span class="at">linetype=</span>model ), <span class="at">size=</span><span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>( <span class="at">data=</span>imp6.pred, <span class="fu">aes</span>( <span class="at">x=</span>time, <span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span>model ), <span class="at">alpha =</span> .<span class="dv">3</span> ) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>( <span class="at">xintercept =</span> <span class="fu">rcspline.eval</span>( imp<span class="sc">$</span>time, <span class="at">nk =</span> <span class="dv">7</span>, <span class="at">knots.only =</span> T ), <span class="at">linetype =</span> <span class="dv">3</span> ) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>( <span class="at">values=</span>cbbPalette) <span class="sc">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>( <span class="at">values=</span>cbbPalette) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">rcspline.eval</span>( imp<span class="sc">$</span>time, <span class="at">nk =</span> <span class="dv">7</span>, <span class="at">knots.only =</span> T ),</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;24</span><span class="sc">\n</span><span class="st">Knot 1&#39;</span>,<span class="st">&#39;182</span><span class="sc">\n</span><span class="st">Knot 2&#39;</span>,<span class="st">&#39;342</span><span class="sc">\n</span><span class="st">Knot 3&#39;</span>,<span class="st">&#39;500</span><span class="sc">\n</span><span class="st">Knot 4&#39;</span>,<span class="st">&#39;658</span><span class="sc">\n</span><span class="st">Knot 5&#39;</span>,<span class="st">&#39;818</span><span class="sc">\n</span><span class="st">Knot 6&#39;</span>,<span class="st">&#39;976</span><span class="sc">\n</span><span class="st">Knot 7&#39;</span>)) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y=</span><span class="st">&#39;ERP Amplitude&#39;</span>, <span class="at">x=</span><span class="st">&#39;Time (ms)&#39;</span>, <span class="at">colour =</span> <span class="st">&#39;Model Type&#39;</span>, <span class="at">fill =</span> <span class="st">&#39;Model Type&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;Model Type&#39;</span>) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span> )</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>impplot</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="latent-growth-curve-model-simulated-data"
class="section level2">
<h2>Latent Growth Curve Model: Simulated Data</h2>
<p>Now we can apply the</p>
<p>I adapt <a
href="https://www.rdocumentation.org/packages/rms/versions/6.3-0/topics/Gls">code</a>
from the <em>rms</em> package documentation to simulate longitudinal
data in the “long” format, with as many rows per participant (<span
class="math inline">\(N=500\)</span>) as there are time points. The
outcome variable is continuous and is measured at 10 time points.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ns  <span class="ot">&lt;-</span> <span class="dv">500</span>  <span class="co"># no. subjects</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>nt  <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># no. time points/subject</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>           <span class="co"># usually do 100 for variances, 1000 for nonparametric CLs</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> .<span class="dv">5</span>  <span class="co"># AR(1) correlation parameter</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>nt, <span class="at">ncol=</span>nt)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> rho<span class="sc">^</span><span class="fu">abs</span>(<span class="fu">row</span>(V)<span class="sc">-</span><span class="fu">col</span>(V))   <span class="co"># per-subject correlation/covariance matrix</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">tim=</span><span class="dv">1</span><span class="sc">:</span>nt, <span class="at">id=</span><span class="dv">1</span><span class="sc">:</span>ns)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>trt <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(d<span class="sc">$</span>id <span class="sc">&lt;=</span> ns<span class="sc">/</span><span class="dv">2</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>))</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>true.beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Intercept=</span><span class="dv">0</span>,<span class="at">tim=</span>.<span class="dv">1</span>,<span class="st">&#39;tim^2&#39;</span><span class="ot">=</span><span class="dv">0</span>,<span class="st">&#39;trt=b&#39;</span><span class="ot">=</span><span class="dv">1</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>ey  <span class="ot">&lt;-</span> true.beta[<span class="st">&#39;Intercept&#39;</span>] <span class="sc">+</span> true.beta[<span class="st">&#39;tim&#39;</span>]<span class="sc">*</span>d<span class="sc">$</span>tim <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  true.beta[<span class="st">&#39;tim^2&#39;</span>]<span class="sc">*</span>(d<span class="sc">$</span>tim<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span>  true.beta[<span class="st">&#39;trt=b&#39;</span>]<span class="sc">*</span>(d<span class="sc">$</span>trt<span class="sc">==</span><span class="st">&#39;b&#39;</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>y <span class="ot">&lt;-</span> d<span class="sc">$</span>ey <span class="sc">+</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(<span class="fu">mvrnorm</span>(<span class="at">n=</span>ns, <span class="at">mu=</span><span class="fu">rep</span>(<span class="dv">0</span>,nt), <span class="at">Sigma=</span>V)))</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( d )</span></code></pre></div>
<pre><code>##   tim id trt  ey          y
## 1   1  1   a 0.1  0.5882726
## 2   2  1   a 0.2  0.3848211
## 3   3  1   a 0.3  0.2521702
## 4   4  1   a 0.4 -0.1599721
## 5   5  1   a 0.5  0.4922491
## 6   6  1   a 0.6  1.0155186</code></pre>
<p>The data need to be converted to a “wide” format do that there are as
many columns for y as there are time points in order to run latent
growth curve analyses.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dwide <span class="ot">&lt;-</span> <span class="fu">reshape</span>( d, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">v.names =</span> <span class="st">&#39;y&#39;</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idvar =</span> <span class="st">&#39;id&#39;</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">timevar =</span> <span class="st">&#39;tim&#39;</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">drop =</span> <span class="st">&#39;ey&#39;</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">direction =</span> <span class="st">&#39;wide&#39;</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( dwide )</span></code></pre></div>
<pre><code>##    id trt          y1          y2          y3         y4         y5         y6
## 1   1   a  0.58827257  0.38482114  0.25217024 -0.1599721  0.4922491  1.0155186
## 11  2   a  0.03617872 -0.25982652 -0.60129670 -0.1308699  0.4330295  0.4124045
## 21  3   a -0.06226558  0.66983650 -0.06613045 -1.9655144 -1.7573864 -1.1152684
## 31  4   a  1.38961926  2.05595014  0.48393874 -0.0909192  0.6643151  0.8747693
## 41  5   a -0.23180750 -0.45156763 -1.31328486 -0.9097320 -1.6767800  0.9190582
## 51  6   a -0.06663219  0.06952871  0.67336023  0.8823301  0.9233409  1.6596319
##             y7          y8          y9        y10
## 1   0.06412915 -0.03155166  0.08529256 -0.4500277
## 11  1.05727635  1.65434938  2.36778901  3.1373330
## 21  0.60034262  0.44959370  0.16941534  0.4667622
## 31  0.65607181 -0.49444170 -0.95592965  0.1522094
## 41  0.42395932  1.39810455  1.12466302  0.7306459
## 51 -0.60631723 -0.91693728 -0.60780628  0.6470781</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dwide<span class="sc">$</span>trt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>( dwide<span class="sc">$</span>trt ) <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<p>Now we can set up the latent growth curve model using the <a
href="https://www.lavaan.ugent.be/">lavaan</a> package. We want to model
the effect of time using a restricted cubic spline. Unlike in standard
regression models where time effects are captured by observed variables
included in the dataset, time effects are captured by latent
(unobserved) intercept &amp; slope variables (“growth factors”) in
latent growth curve (LGC) models. The factor loadings are (typically)
fixed at values selected to model a specific trajectory shape. To model
a nonlinear trajectory using a restricted cubic spline, we need to have
<span class="math inline">\(k-1\)</span> latent slope variables to
capture the time effect. For this example, I will model a 3-knot RCS
effect for time (<span class="math inline">\(df=2\)</span>) with knots
at time points 2, 5, and 9 – so we will need to latent slope factors.
Note, this is the same number of <span class="math inline">\(df\)</span>
that would be required to estimate a quadratic growth model. The
question is: How do we constrain the factor loadings in order to
estimate the appropriate restricted cubic spline trajectory.
Unfortunately, I don’t know of any existing functions equivalent to
<em>rms</em> function <strong>rcs()</strong> that can automate this
process when using the <em>lavaan</em> package. However, the
<strong>rcspline.eval()</strong> function from the <em>Hmisc</em>
package can help us so that we don’t have to figure it manually. The
values for the factor loadings of the two latent slopes are provided
below. Note, the first slope is linear and the second captures the
nonlinear effect.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>long.spline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">rcspline.eval</span>( d<span class="sc">$</span>tim, <span class="at">nk =</span> <span class="dv">3</span>, <span class="at">knots =</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">9</span> ), <span class="at">inclx =</span> T) )</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>( long.spline ) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;rcs1&#39;</span>,<span class="st">&#39;rcs2&#39;</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>long.spline1 <span class="ot">&lt;-</span> long.spline[ <span class="fu">unique</span>( long.spline<span class="sc">$</span>rcs1 ), ]</span></code></pre></div>
<p>We now specify a latent growth curve model just as you <a
href="https://www.lavaan.ugent.be/tutorial/growth.html">typically
would</a>, except using the the factor loadings for the two latent
slopes we obtained above. We’ll also evaluate the effect of the
treatment variable on the outcome trajectories by regressing the
intercept &amp; slopes on the <em>trt</em> variable.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sim.lgc1 <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="st">## Define the latent intecept</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="st">i =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5 + 1*y6 + 1*y7 + 1*y8 + 1*y9 + 1*y10</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="st">## Define the two latent slopes using the factor loading values obtained above</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="st">rcs1 =~ 1*y1 + 2*y2 + 3*y3 + 4*y4 + 5*y5 + 6*y6 + 7*y7 + 8*y8 + 9*y9 + 10*y10</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="st">rcs2 =~ 0*y1 + 0*y2 + 0.02040816*y3 + 0.16326531*y4 + 0.55102041*y5 + 1.27040816*y6 + 2.26530612*y7 + 3.44387755*y8 + 4.71428571*y9 + 6*y10</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="st">## Hold error variances constant over time</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="st">y1 ~~ e*y1; y2 ~~ e*y2; y3 ~~ e*y3; y4 ~~ e*y4; y5 ~~ e*y5; y6 ~~ e*y6; y7 ~~ e*y7; y8 ~~ e*y8; y9 ~~ e*y9; y10 ~~ e*y10</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="st">## Regress growth factors on treatment</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="st">i + rcs1 + rcs2 ~ trt</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>sim.lgc1.fit <span class="ot">&lt;-</span> <span class="fu">growth</span>( sim.lgc1, <span class="at">data =</span> dwide, <span class="at">auto.cov.y =</span>F, <span class="at">auto.var =</span> F )</span></code></pre></div>
<p>We can then use the summary function to see the results. The
<em>trt</em> variable has an effect on the latent intercept and first
(linear) RCS latent slope.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( sim.lgc1.fit )</span></code></pre></div>
<pre><code>## lavaan 0.6-11 ended normally after 41 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                        22
##   Number of equality constraints                     9
##                                                       
##   Number of observations                           500
##                                                       
## Model Test User Model:
##                                                       
##   Test statistic                               351.684
##   Degrees of freedom                                62
##   P-value (Chi-square)                           0.000
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Latent Variables:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   i =~                                                
##     y1                1.000                           
##     y2                1.000                           
##     y3                1.000                           
##     y4                1.000                           
##     y5                1.000                           
##     y6                1.000                           
##     y7                1.000                           
##     y8                1.000                           
##     y9                1.000                           
##     y10               1.000                           
##   rcs1 =~                                             
##     y1                1.000                           
##     y2                2.000                           
##     y3                3.000                           
##     y4                4.000                           
##     y5                5.000                           
##     y6                6.000                           
##     y7                7.000                           
##     y8                8.000                           
##     y9                9.000                           
##     y10              10.000                           
##   rcs2 =~                                             
##     y1                0.000                           
##     y2                0.000                           
##     y3                0.020                           
##     y4                0.163                           
##     y5                0.551                           
##     y6                1.270                           
##     y7                2.265                           
##     y8                3.444                           
##     y9                4.714                           
##     y10               6.000                           
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   i ~                                                 
##     trt               0.885    0.114    7.752    0.000
##   rcs1 ~                                              
##     trt               0.013    0.033    0.391    0.696
##   rcs2 ~                                              
##     trt              -0.021    0.044   -0.475    0.635
## 
## Covariances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##  .i ~~                                                
##    .rcs1             -0.231    0.028   -8.398    0.000
##    .rcs2              0.220    0.034    6.504    0.000
##  .rcs1 ~~                                             
##    .rcs2             -0.098    0.011   -8.861    0.000
## 
## Intercepts:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .y1                0.000                           
##    .y2                0.000                           
##    .y3                0.000                           
##    .y4                0.000                           
##    .y5                0.000                           
##    .y6                0.000                           
##    .y7                0.000                           
##    .y8                0.000                           
##    .y9                0.000                           
##    .y10               0.000                           
##    .i                 0.063    0.081    0.779    0.436
##    .rcs1              0.090    0.023    3.914    0.000
##    .rcs2              0.018    0.031    0.576    0.565
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .y1         (e)    0.575    0.014   41.833    0.000
##    .y2         (e)    0.575    0.014   41.833    0.000
##    .y3         (e)    0.575    0.014   41.833    0.000
##    .y4         (e)    0.575    0.014   41.833    0.000
##    .y5         (e)    0.575    0.014   41.833    0.000
##    .y6         (e)    0.575    0.014   41.833    0.000
##    .y7         (e)    0.575    0.014   41.833    0.000
##    .y8         (e)    0.575    0.014   41.833    0.000
##    .y9         (e)    0.575    0.014   41.833    0.000
##    .y10        (e)    0.575    0.014   41.833    0.000
##    .i                 1.017    0.104    9.763    0.000
##    .rcs1              0.080    0.008    9.475    0.000
##    .rcs2              0.146    0.016    9.280    0.000</code></pre>
<p>Now let’s run a similar model in a mixed-effects modeling framework
using the <a
href="https://www.rdocumentation.org/packages/nlme/versions/3.1-160">nlme
package</a> to see if we get a similar result. We will use the “long”
simulated data file to run these analyses.</p>
<p>When you call the <strong>rcs()</strong> function, <span
class="math inline">\(k-1\)</span> new variables are created</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>timspline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">rcspline.eval</span>( d<span class="sc">$</span>tim , <span class="at">nk =</span> <span class="dv">3</span>, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">9</span> ), <span class="at">inclx =</span> T ) )</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>( timspline ) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;rcs1&#39;</span>,<span class="st">&#39;rcs2&#39;</span> )</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( d, timspline )</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>lme.sim1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(  y <span class="sc">~</span> rcs1<span class="sc">*</span>trt <span class="sc">+</span> rcs2<span class="sc">*</span>trt, </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">random =</span><span class="sc">~</span> rcs1 <span class="sc">+</span> rcs2 <span class="sc">|</span> id, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> d1  )</span></code></pre></div>
<p>Let’s look at the coefficients from the mixed-effects model.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( lme.sim1 )</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: d1 
##        AIC      BIC    logLik
##   13265.32 13350.02 -6619.658
## 
## Random effects:
##  Formula: ~rcs1 + rcs2 | id
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev    Corr         
## (Intercept) 1.0115544 (Intr) rcs1  
## rcs1        0.2840859 -0.810       
## rcs2        0.3828794  0.573 -0.905
## Residual    0.7579719              
## 
## Fixed effects:  y ~ rcs1 * trt + rcs2 * trt 
##                  Value  Std.Error   DF   t-value p-value
## (Intercept)  0.0628994 0.08091218 4496  0.777379  0.4370
## rcs1         0.0900480 0.02305367 4496  3.906015  0.0001
## trtb         0.8852288 0.11442711  498  7.736181  0.0000
## rcs2         0.0180322 0.03138243 4496  0.574597  0.5656
## rcs1:trtb    0.0127186 0.03260281 4496  0.390109  0.6965
## trtb:rcs2   -0.0210199 0.04438145 4496 -0.473618  0.6358
##  Correlation: 
##           (Intr) rcs1   trtb   rcs2   rcs1:t
## rcs1      -0.849                            
## trtb      -0.707  0.600                     
## rcs2       0.642 -0.916 -0.454              
## rcs1:trtb  0.600 -0.707 -0.849  0.647       
## trtb:rcs2 -0.454  0.647  0.642 -0.707 -0.916
## 
## Standardized Within-Group Residuals:
##          Min           Q1          Med           Q3          Max 
## -3.213308557 -0.599892914  0.009641107  0.602968349  3.623615406 
## 
## Number of Observations: 5000
## Number of Groups: 500</code></pre>
<p>And now the equivalent coefficients from the latent growth model.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sim.lgc1.par <span class="ot">&lt;-</span> <span class="fu">parameterEstimates</span>( sim.lgc1.fit )</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sim.lgc1.par[ <span class="fu">c</span>(<span class="dv">62</span>,<span class="dv">63</span>,<span class="dv">64</span>,<span class="dv">41</span>,<span class="dv">42</span>,<span class="dv">43</span>), <span class="fu">c</span>(<span class="st">&#39;lhs&#39;</span>,<span class="st">&#39;op&#39;</span>,<span class="st">&#39;rhs&#39;</span>,<span class="st">&#39;est&#39;</span>,<span class="st">&#39;se&#39;</span>,<span class="st">&#39;ci.lower&#39;</span>,<span class="st">&#39;ci.upper&#39;</span>)]</span></code></pre></div>
<pre><code>##     lhs op rhs    est    se ci.lower ci.upper
## 62    i ~1      0.063 0.081   -0.095    0.221
## 63 rcs1 ~1      0.090 0.023    0.045    0.135
## 64 rcs2 ~1      0.018 0.031   -0.043    0.079
## 41    i  ~ trt  0.885 0.114    0.661    1.109
## 42 rcs1  ~ trt  0.013 0.033   -0.051    0.076
## 43 rcs2  ~ trt -0.021 0.044   -0.108    0.066</code></pre>
<p>You can see that the results are essentially identical. This confirms
that we can apply RCSs within a latent growth curve model to capture
nonlinear trajectories by constraining the factor loadings of the latent
slope factors just as you would constrain the values of time variables
within a standard regression framework.</p>
</div>
<div id="latent-growth-curve-model-perceived-stress-trajectories"
class="section level2">
<h2>Latent Growth Curve Model: Perceived Stress Trajectories</h2>
<p>Now let’s apply the RCS approach using real longitudinal data from
the College Transition Study. In this study, incoming college students
completed mental health surveys 8 times during their first semester at a
large university (twice per month during the fall semester). To
demonstrate the use of RCSs, we will model perceived stress trajectories
assuming a nonlinear trajectory defined by an unknown function that we
hope can be well estimated using a 3-knot RCS. We will evaluate whether
a continuous predictor (measuring students dysfunctional beliefs)
predicts perceived stress trajectories. We don’t want to assume that
dysfunctional attitudes predicts perceived stress in a linear fashion,
so we will use a 3-knot RCS to allow for a flexible nonlinear
effect.</p>
<p>Load in the data.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>( <span class="st">&#39;cts.splines.Rdata&#39;</span> )</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span>( <span class="fu">describe</span>( cts.splines ) )</span></code></pre></div>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<script type="text/javascript">
<!--
    function expand_collapse(id) {
       var e = document.getElementById(id);
       var f = document.getElementById(id+"_earrows");
       if(e.style.display == 'none'){
          e.style.display = 'block';
          f.innerHTML = '&#9650';
       }
       else {
          e.style.display = 'none';
          f.innerHTML = '&#9660';
       }
    }
//-->
</script>
<style>
.earrows {color:silver;font-size:11px;}

fcap {
 font-family: Verdana;
 font-size: 12px;
 color: MidnightBlue
 }

smg {
 font-family: Verdana;
 font-size: 10px;
 color: &#808080;
}

hr.thinhr { margin-top: 0.15em; margin-bottom: 0.15em; }

span.xscript {
position: relative;
}
span.xscript sub {
position: absolute;
left: 0.1em;
bottom: -1ex;
}
</style>
 <font color="MidnightBlue"><div align=center><span style="font-weight:bold">cts.splines <br><br> 5  Variables   656  Observations</span></div></font> <hr class="thinhr"> <span style="font-weight:bold">id</span>: Unique participant identifier<div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAYUlEQVQ4je2TMQpAMQhDG+9/6E9rItROfyh0iIupeUgoOICRhVmUW5M+ASk6aBNO0XctW0wCxZUdwUfMotya9AlI0Yk24TT6rmWLSaC4sp3LuW7m8j3++y/ncq6buR69xw9LQQTEAnSbxwAAAABJRU5ErkJggg==" alt="image" /></div> <style>
 .hmisctable587286 {
 border: none;
 font-size: 85%;
 }
 .hmisctable587286 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable587286 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable587286">
 <tr><th>n</th><th>missing</th><th>distinct</th></tr>
 <tr><td>656</td><td>0</td><td>82</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> : 1074614  1765339  2882872  4269441  8864786  ,  <font color="MidnightBlue">highest</font>: 98980864 99999996 99999997 99999998 99999999</span> <hr class="thinhr"> <span style="font-weight:bold">psstot</span>: Composite Perceived Stress Score<div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAH8AAAANCAMAAAC3iUHrAAAACVBMVEUAAADMzMz////1iUV5AAAAhklEQVQ4jdWTiwrAIAhFr/v/j16PNXpo6laDiagYeQxuoOcGvLhcZhx+Q7CcuxgCnAOX8JOXvIcvsz7g36MHFtf7F98i8RBbHxpdb5H+K6E53l+LU3//BC6ADHz7FsL5DLSFj6pQQD6+sgGPXcMXvkWzUdQqosIZRQtCN+ifa9NFSjVySXQCxaYH70IapV4AAAAASUVORK5CYII=" alt="image" /></div> <style>
 .hmisctable433680 {
 border: none;
 font-size: 85%;
 }
 .hmisctable433680 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable433680 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable433680">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>607</td><td>49</td><td>42</td><td>0.998</td><td>22.5</td><td>8.82</td><td>10</td><td>12</td><td>17</td><td>23</td><td>28</td><td>32</td><td>35</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> :  3  4  5  6  7 ,  <font color="MidnightBlue">highest</font>: 41 42 43 44 45</span> <hr class="thinhr"> <span style="font-weight:bold">sex</span>: Participant-Reported Sex <style>
 .hmisctable243469 {
 border: none;
 font-size: 85%;
 }
 .hmisctable243469 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable243469 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable243469">
 <tr><th>n</th><th>missing</th><th>distinct</th></tr>
 <tr><td>656</td><td>0</td><td>2</td></tr>
 </table>
 <pre style="font-size:85%;">
 Value      Female   Male
 Frequency     376    280
 Proportion  0.573  0.427
 </pre>
 <hr class="thinhr"> <span style="font-weight:bold">dasct</span>: Compsite Dysfunctional Attitudes Score (mean centered)<div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAi0lEQVQ4je1TWwrAIAyL3v/Qw6WDPlQcK9s+7EeRtCShGJSMAlJoNGPNKOTQaMYclu98UXpgYPsaSL/nayltkMiBpRPIWQikXZq8H+QR7RznScSXvhBn4WB2afIeaf7Xl9myEtenctWBiEurbpNQ8KWgMN2+bvpy6Wg0PjhBvwMRl1bcJqGQRwWF6QHSPAq29oz/zAAAAABJRU5ErkJggg==" alt="image" /></div> <pre style="font-size:85%;">
         n   missing  distinct      Info      Mean       Gmd       .05       .10 
       648         8        61     0.999 1.368e-14     31.62   -37.528   -30.528 
       .25       .50       .75       .90       .95 
   -19.528    -2.528    15.472    38.472    54.472 
 </pre>
 <style>
 .hmisctable553944 {
 border: none;
 font-size: 85%;
 }
 .hmisctable553944 td {
 text-align: right;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable553944 th {
 color: Black;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: bold;
 }
 </style>
 <table class="hmisctable553944">
 <tr><td><font color="MidnightBlue">lowest</font> :</td><td>-66.52843</td><td>-52.52843</td><td>-50.52843</td><td>-38.52843</td><td>-37.52843</td></tr>
 <tr><td><font color="MidnightBlue">highest</font>:</td><td> 42.47157</td><td> 54.47157</td><td> 62.47157</td><td> 73.47157</td><td> 86.47157</td></tr>
 </table>
 <hr class="thinhr"> <span style="font-weight:bold">weeks</span>: Week of Follow-up (0=Baseline)<div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAABkAAAANCAMAAABrcDXcAAAACVBMVEUAAADMzMz////1iUV5AAAAIElEQVQYlWNgYGRkYAAhGIZQIMDEBMRQCsGkp8xQdBsAmoEA55cm0HQAAAAASUVORK5CYII=" alt="image" /></div> <style>
 .hmisctable999868 {
 border: none;
 font-size: 85%;
 }
 .hmisctable999868 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable999868 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable999868">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>656</td><td>0</td><td>8</td><td>0.984</td><td>6.875</td><td>5.039</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> :  0  2  4  6  8 ,  <font color="MidnightBlue">highest</font>:  6  8 10 12 13</span> <pre style="font-size:85%;">
 Value          0     2     4     6     8    10    12    13
 Frequency     82    82    82    82    82    82    82    82
 Proportion 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125
 </pre>
 <hr class="thinhr">
<p>Create a wide version of the CTS data for latent growth modeling.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cts.wide <span class="ot">&lt;-</span> <span class="fu">reshape</span>( cts.splines,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">direction =</span> <span class="st">&#39;wide&#39;</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">v.names =</span> <span class="st">&#39;psstot&#39;</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">timevar =</span> <span class="st">&#39;weeks&#39;</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">idvar =</span> <span class="st">&#39;id&#39;</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sep =</span> <span class="st">&#39;&#39;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                     )</span></code></pre></div>
<p>We do not want to make the assumption that the time-invariant
dysfunctional attitudes variable (<em>dasct</em>) affects stress
trajectories in a linear manner; rather, we would like to at least allow
for possible non-linearity. We’ll model the effect of <em>dasct</em>
with a 3-knot restricted cubic spline allowing the knots to be placed at
their default values (outer knots placed at the 0.10 and 0.90 quantiles
of <em>dasct</em>). There is no equivalent to the <strong>rcs()</strong>
function provided in the <em>rms</em> package in the <em>lavaan</em>
package. Consequently, we need to create <span
class="math inline">\(k-1\)</span> time variables (where <span
class="math inline">\(k\)</span> is the number of knots) to include in
the <em>cts.wide</em> data frame in order to estimate the nonlinear
effect. We use the <strong>rcspline.eval()</strong> function (rms
package) to create new nonlinear time variable
(<em>dasct.nonlinear</em>) needed to estimate a 3-knot restricted cubic
spline effect of dysfunctional attitudes on stress trajectories, then
creating a new data frame (<em>cts.wide1</em>) that merges this new
nonlinear variable with the <em>cts.wide</em> data frame. We can then
estimate the 3-knot restricted cubic spline effect by including both the
<em>dasct</em> and the <em>dasct.nonlinear</em> variables as predictors
in the model, representing the linear and nonlinear effects,
respectively.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>das.spline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">rcspline.eval</span>( cts.wide<span class="sc">$</span>dasct, <span class="at">nk =</span> <span class="dv">3</span> ) )</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>( das.spline ) <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;dasct.nonlinear&#39;</span> )</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>cts.wide1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( cts.wide, das.spline )</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( cts.wide1 )</span></code></pre></div>
<pre><code>##          id    sex      dasct psstot0 psstot2 psstot4 psstot6 psstot8 psstot10
## 1   1074614 Female -10.528432      26      43      23      20      23       29
## 9   1765339   Male -50.528432       8      15      15      16       6       32
## 17  2882872 Female  23.471568      33      26      25      20      27       18
## 25  4269441 Female -27.528432      15      24      29      26      26       30
## 33  8864786 Female -31.528432      14      24      18      13      16       14
## 41 10417541 Female   4.471568      26      23      26      20      26       29
##    psstot12 psstot13 dasct.nonlinear
## 1        28       NA      2.32549622
## 9        18       21      0.00000000
## 17       22        9     23.46558593
## 25       27       33      0.11814745
## 33       15       11      0.02551985
## 41       26       32      8.68790004</code></pre>
<p>We also want to use a 3-knot restricted cubic spline to estimate a
nonlinear stress trajectory.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">rcspline.eval</span>( cts.splines<span class="sc">$</span>weeks, <span class="at">nk =</span> <span class="dv">3</span>, <span class="at">knots =</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">14</span> ), <span class="at">inclx =</span> T ) )</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>knots1 <span class="ot">&lt;-</span> knots[ <span class="sc">!</span><span class="fu">duplicated</span>( knots<span class="sc">$</span>x ), ] </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>( knots1 ) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Linear Slope&#39;</span>,<span class="st">&#39;Nonlinear Slope&#39;</span> )</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>knots1</span></code></pre></div>
<pre><code>##   Linear Slope Nonlinear Slope
## 1            0        0.000000
## 2            2        0.000000
## 3            4        0.000000
## 4            6        0.080000
## 5            8        0.640000
## 6           10        2.026667
## 7           12        4.053333
## 8           13        5.206667</code></pre>
<p>The RCS growth curve model fits the data well. But we may be able to
simplify the model by allowing the perceived stress growth trajectory to
be linear.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>stress.lgc1 <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="st">## Define the latent growth factors -- intercept, linear slope, and nonlinear slope</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="st">i =~ 1*psstot0 + 1*psstot2 + 1*psstot4 + 1*psstot6 + 1*psstot8 + 1*psstot10 + 1*psstot12 + 1*psstot13</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="st">lin =~ 0*psstot0 + 2*psstot2 + 4*psstot4 + 6*psstot6 + 8*psstot8 + 10*psstot10 + 12*psstot12 + 13*psstot13</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="st">nonlin =~ 0*psstot0 + 0*psstot2 + 0*psstot4 + 0.08*psstot6 + 0.64*psstot8 + 2.026667*psstot10 + 4.053333*psstot12 + 5.206667*psstot13</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="st">## Estimate first-order autoregressive effect -- hold effect constant over time by giving each the same label -- phi</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="st">## Constrain variances of latent growth models to = 0 -- i.e., no random effects</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ i</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="st">lin ~~ lin</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="st">nonlin ~~ nonlin</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ lin</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ nonlin</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="st">lin ~~ nonlin</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="st">## Constrain error variances to be constant over time</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="st">psstot0 ~~ e*psstot0</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="st">psstot2 ~~ e*psstot2</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="st">psstot4 ~~ e*psstot4</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="st">psstot6 ~~ e*psstot6</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="st">psstot8 ~~ e*psstot8</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="st">psstot10 ~~ e*psstot10</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="st">psstot12 ~~ e*psstot12</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="st">psstot13 ~~ e*psstot13</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="st">## Estimate effects of DAS on stress trajectories</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="st">i  ~ dasct + dasct.nonlinear</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;</span> </span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>stress.lgc1.fit <span class="ot">&lt;-</span> <span class="fu">growth</span>( stress.lgc1,</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> cts.wide1,</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">estimator =</span> <span class="st">&#39;ml&#39;</span> )</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>fitmeas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;npar&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;df&quot;</span>, <span class="st">&quot;pvalue&quot;</span>, <span class="st">&quot;tfi&quot;</span>, <span class="st">&quot;rmsea&quot;</span>,<span class="st">&quot;rmsea.ci.lower&quot;</span>,<span class="st">&quot;rmsea.ci.upper&quot;</span>,<span class="st">&quot;srmr&quot;</span>)</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>( stress.lgc1.fit, <span class="at">fit.measures =</span> fitmeas )</span></code></pre></div>
<pre><code>##           npar          chisq             df         pvalue          rmsea 
##         12.000         49.925         48.000          0.397          0.025 
## rmsea.ci.lower rmsea.ci.upper           srmr 
##          0.000          0.087          0.092</code></pre>
<p>Fit a linear growth trajectory by eliminating the nonlinear latent
slope parameter. This results in a gain of 4 <span
class="math inline">\(df\)</span>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>stress.lgc2 <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="st">## Define the latent growth factors -- intercept, linear slope, and nonlinear slope</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="st">i =~ 1*psstot0 + 1*psstot2 + 1*psstot4 + 1*psstot6 + 1*psstot8 + 1*psstot10 + 1*psstot12 + 1*psstot13</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="st">lin =~ 0*psstot0 + 2*psstot2 + 4*psstot4 + 6*psstot6 + 8*psstot8 + 10*psstot10 + 12*psstot12 + 13*psstot13</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="st">## Estimate first-order autoregressive effect -- hold effect constant over time by giving each the same label -- phi</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="st"># psstot13 ~ phi*psstot12</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="st"># psstot12 ~ phi*psstot10</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="st"># psstot10 ~ phi*psstot8</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="st"># psstot8 ~ phi*psstot6</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="st"># psstot6 ~ phi*psstot4</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="st"># psstot4 ~ phi*psstot2</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="st"># psstot2 ~ phi*psstot0</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="st">## Constrain variances of latent growth models to = 0 -- i.e., no random effects</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ i</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="st">lin ~~ lin</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ lin</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="st">## Constrain error variances to be constant over time</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="st">psstot0 ~~ e*psstot0</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="st">psstot2 ~~ e*psstot2</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="st">psstot4 ~~ e*psstot4</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="st">psstot6 ~~ e*psstot6</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="st">psstot8 ~~ e*psstot8</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="st">psstot10 ~~ e*psstot10</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="st">psstot12 ~~ e*psstot12</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="st">psstot13 ~~ e*psstot13</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="st">## Estimate effects of DAS on stress trajectories</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="st">i  ~ dasct + dasct.nonlinear</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;</span> </span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>stress.lgc2.fit <span class="ot">&lt;-</span> <span class="fu">growth</span>( stress.lgc2,</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> cts.wide1,</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>                          <span class="at">estimator =</span> <span class="st">&#39;ml&#39;</span> )</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>( stress.lgc2.fit, <span class="at">fit.measures =</span> fitmeas )</span></code></pre></div>
<pre><code>##           npar          chisq             df         pvalue          rmsea 
##          8.000         77.809         52.000          0.012          0.089 
## rmsea.ci.lower rmsea.ci.upper           srmr 
##          0.043          0.128          0.117</code></pre>
<p>Conduct a likelihood ratio test (<span
class="math inline">\(df=4\)</span>) comparing the nonlinear RCS growth
model and the simpler linear growth model. The <span
class="math inline">\(\chi^2\)</span> value is highly significant and
the AIC value is smaller for the nonlinear RCS growth model. Therefore,
we will retain the nonlinear growth parameter.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>( stress.lgc1.fit, stress.lgc2.fit )</span></code></pre></div>
<pre><code>## Chi-Squared Difference Test
## 
##                 Df    AIC    BIC  Chisq Chisq diff Df diff Pr(&gt;Chisq)    
## stress.lgc1.fit 48 3182.3 3208.0 49.925                                  
## stress.lgc2.fit 52 3202.2 3219.3 77.809     27.884       4  1.317e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Next, we can test whether we can simplify the model by simplifying
the effect of dysfunctional attitudes on perceived stress trajectories
by constraining the effect to be linear (i.e., getting rid of the
nonlinear RCS effect).</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>stress.lgc3 <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="st">## Define the latent growth factors -- intercept, linear slope, and nonlinear slope</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="st">i =~ 1*psstot0 + 1*psstot2 + 1*psstot4 + 1*psstot6 + 1*psstot8 + 1*psstot10 + 1*psstot12 + 1*psstot13</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="st">lin =~ 0*psstot0 + 2*psstot2 + 4*psstot4 + 6*psstot6 + 8*psstot8 + 10*psstot10 + 12*psstot12 + 13*psstot13</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="st">nonlin =~ 0*psstot0 + 0*psstot2 + 0*psstot4 + 0.08*psstot6 + 0.64*psstot8 + 2.026667*psstot10 + 4.053333*psstot12 + 5.206667*psstot13</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="st">## Estimate first-order autoregressive effect -- hold effect constant over time by giving each the same label -- phi</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="st">## Constrain variances of latent growth models to = 0 -- i.e., no random effects</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ i</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="st">lin ~~ lin</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="st">nonlin ~~ nonlin</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ lin</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="st">i ~~ nonlin</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="st">lin ~~ nonlin</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="st">## Constrain error variances to be constant over time</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="st">psstot0 ~~ e*psstot0</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="st">psstot2 ~~ e*psstot2</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="st">psstot4 ~~ e*psstot4</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="st">psstot6 ~~ e*psstot6</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="st">psstot8 ~~ e*psstot8</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="st">psstot10 ~~ e*psstot10</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="st">psstot12 ~~ e*psstot12</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="st">psstot13 ~~ e*psstot13</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="st">## Estimate effects of DAS on stress trajectories</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="st">i  ~ dasct + 0*dasct.nonlinear</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;</span> </span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>stress.lgc3.fit <span class="ot">&lt;-</span> <span class="fu">growth</span>( stress.lgc3,</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> cts.wide1,</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">estimator =</span> <span class="st">&#39;ml&#39;</span> )</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>( stress.lgc3.fit, <span class="at">fit.measures =</span> fitmeas )</span></code></pre></div>
<pre><code>##           npar          chisq             df         pvalue          rmsea 
##         11.000         50.558         49.000          0.412          0.022 
## rmsea.ci.lower rmsea.ci.upper           srmr 
##          0.000          0.086          0.094</code></pre>
<p>We can now conduct a <span class="math inline">\(df=1\)</span>
likelihood ratio test to determine whether we need to retain the
nonlinear effect of dysfunctional attitudes. The test is not significant
and the AIC favors the simpler model. So we will eliminate the nonlinear
effect of dysfunctional attitudes.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>( stress.lgc1.fit, stress.lgc3.fit )</span></code></pre></div>
<pre><code>## Chi-Squared Difference Test
## 
##                 Df    AIC    BIC  Chisq Chisq diff Df diff Pr(&gt;Chisq)
## stress.lgc1.fit 48 3182.3 3208.0 49.925                              
## stress.lgc3.fit 49 3180.9 3204.5 50.558    0.63221       1     0.4265</code></pre>
<p>Now let’s look at the results of the final model with a nonlinear
trajectory and linear effect of dysfunctional attitudes. We see that the
linear effect of dysfunctional attitudes is positive and significant,
indicating that students with higher dysfunctional attitudes begin the
semester with higher levels of perceived stress. (Note, we did not
consider in any of the models the possibility that dysfunctional
attitudes affects the shape of students’ stress trajecotries – i.e.,
exposure by time interaction).</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( stress.lgc3.fit )</span></code></pre></div>
<pre><code>## lavaan 0.6-11 ended normally after 103 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                        18
##   Number of equality constraints                     7
##                                                       
##                                                   Used       Total
##   Number of observations                            63          82
##                                                                   
## Model Test User Model:
##                                                       
##   Test statistic                                50.558
##   Degrees of freedom                                49
##   P-value (Chi-square)                           0.412
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Latent Variables:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   i =~                                                
##     psstot0           1.000                           
##     psstot2           1.000                           
##     psstot4           1.000                           
##     psstot6           1.000                           
##     psstot8           1.000                           
##     psstot10          1.000                           
##     psstot12          1.000                           
##     psstot13          1.000                           
##   lin =~                                              
##     psstot0           0.000                           
##     psstot2           2.000                           
##     psstot4           4.000                           
##     psstot6           6.000                           
##     psstot8           8.000                           
##     psstot10         10.000                           
##     psstot12         12.000                           
##     psstot13         13.000                           
##   nonlin =~                                           
##     psstot0           0.000                           
##     psstot2           0.000                           
##     psstot4           0.000                           
##     psstot6           0.080                           
##     psstot8           0.640                           
##     psstot10          2.027                           
##     psstot12          4.053                           
##     psstot13          5.207                           
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   i ~                                                 
##     dasct             0.084    0.023    3.559    0.000
##     dasct.nonliner    0.000                           
## 
## Covariances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##  .i ~~                                                
##     lin              -0.713    0.885   -0.806    0.420
##     nonlin           -0.864    1.812   -0.477    0.633
##   lin ~~                                              
##     nonlin           -1.057    0.410   -2.575    0.010
## 
## Intercepts:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .psstot0           0.000                           
##    .psstot2           0.000                           
##    .psstot4           0.000                           
##    .psstot6           0.000                           
##    .psstot8           0.000                           
##    .psstot10          0.000                           
##    .psstot12          0.000                           
##    .psstot13          0.000                           
##    .i                21.820    0.764   28.563    0.000
##     lin               0.118    0.133    0.884    0.377
##     nonlin           -0.418    0.294   -1.424    0.155
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .i                25.503    6.590    3.870    0.000
##     lin               0.619    0.203    3.055    0.002
##     nonlin            2.876    0.989    2.907    0.004
##    .psstot0    (e)   18.082    1.441   12.550    0.000
##    .psstot2    (e)   18.082    1.441   12.550    0.000
##    .psstot4    (e)   18.082    1.441   12.550    0.000
##    .psstot6    (e)   18.082    1.441   12.550    0.000
##    .psstot8    (e)   18.082    1.441   12.550    0.000
##    .psstot10   (e)   18.082    1.441   12.550    0.000
##    .psstot12   (e)   18.082    1.441   12.550    0.000
##    .psstot13   (e)   18.082    1.441   12.550    0.000</code></pre>
</div>
<div id="conclusions" class="section level2">
<h2>Conclusions</h2>
<p>Hopefully, this demonstration will help others implement restricted
cubic splines to model nonlinear trajectories and nonlinear effects of
continuous predictors in SEM models. Unfortunately, I don’t know of a
simple way to make plots of predicted values against the observed data
when working in the SEM framework. It can be done but would be fairly
tedious. Automating this to mimic the <em>rms</em> package should be a
goal moving forward.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
